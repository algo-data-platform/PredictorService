cc_config(
	extra_incs= [
		'/usr/include/libdwarf',
		'thirdparty',
		'thirdparty/boost',
		'thirdparty/openssl/include',
		'thirdparty/bzip2',
		'thirdparty/double-conversion',
		'thirdparty/googletest/googletest/include',
		'thirdparty/googletest/googlemock/include',
		'thirdparty/folly',
		'thirdparty/glog/src',
		'thirdparty/gflags/src',
		'thirdparty/libevent/include',
		'thirdparty/zstd/lib',
		'thirdparty/zlib',
		'thirdparty/snappy',
		'thirdparty/lz4/lib',
    'thirdparty/proxygen',
    'thirdparty/wangle',
		'thirdparty/rsocket-cpp',
    'thirdparty/mstch/include',
    'thirdparty/krb5/include/',
    'thirdparty/fbthrift',
    'blade-bin/thirdparty/fbthrift',
    'thirdparty/hash/smhasher/src',
    'thirdparty/rapidjson',
    'thirdparty/librdkafka/src-cpp/',
    'thirdparty/abseil-cpp/',
    'thirdparty/eigen',
    'thirdparty/catboost/include/',
	],
	cxxflags=[
		'-std=gnu++17',
		'-fomit-frame-pointer', 
		'-momit-leaf-frame-pointer',
    '-D_GLIBCXX_USE_CXX11_ABI=0',
    '-DBOOST_HASH_CXX17=0',
    # refer D104
    '-msse3',
    '-msse4',
    '-msse4.1',
    '-msse4.2',
    '-mpclmul', 
		'-fno-builtin-memcmp',
	],
	cpplint = "cpplint",
  warnings = [
		# enable C++17 over-aligned new support
		'-faligned-new', 
    '-Wall',
    '-Wextra',
    # disable some warnings enabled by Wextra
    '-Wno-unused-but-set-variable',
    '-Wno-unused-parameter',
    '-Wno-unused-local-typedefs',
    '-Wno-missing-field-initializers',
    # other useful warnings
    '-Wendif-labels',
    '-Wfloat-equal',
    '-Wformat=2',
    '-Wframe-larger-than=69632', # A 64k buffer and other small vars
    '-Wmissing-include-dirs',
    '-Wpointer-arith',
    '-Wwrite-strings',
    # error flags
    '-Werror=char-subscripts',
    '-Werror=comments',
    '-Werror=conversion-null',
    '-Werror=empty-body',
    '-Werror=endif-labels',
    '-Werror=format',
    '-Werror=missing-include-dirs',
    '-Werror=overflow',
    '-Werror=parentheses',
    '-Werror=reorder',
    '-Werror=return-type',
    '-Werror=sequence-point',
    #'-Werror=sign-compare',
    '-Werror=switch',
    '-Werror=type-limits',
    '-Werror=uninitialized',
    # Masked it at first
    # '-Werror=unused-function',
    '-Werror=unused-label',
    '-Werror=unused-result',
    '-Werror=unused-value',
    '-Werror=unused-variable',
    '-Werror=write-strings',
  ],
  # C++ only warning flags
  cxx_warnings = [
    '-Wno-invalid-offsetof',
    '-Wnon-virtual-dtor',
    '-Woverloaded-virtual',
    '-Wvla',
    '-Werror=non-virtual-dtor',
    '-Werror=overloaded-virtual',
    #'-Werror=vla',
  ],
  # C only warning flags
  c_warnings = ['-Werror-implicit-function-declaration'],
  # optimize = '-O0',
)

cc_test_config(
	gtest_libs=[
		'//thirdparty/googletest:gtest'
	],
	gtest_main_libs=[
		'//thirdparty/googletest:gtest_main'
	]
)

fbthrift_library_config(
    # The path to thrift compilers.
    fbthrift='blade-bin/thirdparty/fbthrift/thrift1',
    fbthrift_py='thirdparty/build/py_thrift_compiler.sh',
  	fbthrift_templates='thirdparty/fbthrift/thrift/compiler/generate/templates',
    # The libraries depended by thrift.
    fbthrift_libs=[
    ],
    # The extra include paths to be passed to thrift compiler.
    fbthrift_incs=[],
)
